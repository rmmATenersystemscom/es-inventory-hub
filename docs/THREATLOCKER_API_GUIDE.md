# ThreatLocker API Guide: Complete Field Reference

## Overview

This guide provides comprehensive documentation of all available fields from the ThreatLocker API endpoints. This documentation was generated by analyzing live API responses from version v3.0.42 of the dashboard system.

> **📖 Comprehensive API Documentation**: For complete API integration patterns, authentication methods, error handling, and best practices for all integrations (ConnectWise, Veeam VSPC, Veeam VBR, NinjaRMM, ThreatLocker, Fortigate), see [API Documentation](./API_DOCUMENTATION.md).

**Analysis Date**: September 6, 2025  
**Last Updated**: October 8, 2025  
**Total Unique Fields Discovered**: 78  
**API Base URL**: `https://portalapi.g.threatlocker.com`

## 🔑 **Device Identification (Updated)**

**Important**: The ES Inventory Hub now uses `computerId` (UUID format) as the primary unique identifier for ThreatLocker devices instead of hostname. This change:

- **Prevents Duplicate Entries**: Same physical device added multiple times gets same `computerId` = same device identity
- **Enables Duplicate Detection**: DUPLICATE_TL variance detects same hostname with different `computerId` values  
- **Maintains Data Integrity**: Each `computerId` gets its own device identity and history
- **Handles Use Cases**: Supports scenarios like 3 devices → 2 devices → 4 devices with proper tracking

**Key Fields for Device Identification**:
- `computerId`: **Primary unique identifier** (UUID format, used as vendor_device_key)
- `hostname`: **Required for device matching** (used for cross-vendor matching)
- `computerName`: **Display name** (contains user-friendly names with pipe symbols)

## API Authentication

### Environment Variables Required
```bash
# ThreatLocker API Configuration
THREATLOCKER_API_KEY=your_threatlocker_api_key_here
THREATLOCKER_ORGANIZATION_ID=your_main_organization_id_here
```

### Authentication Headers
```python
headers = {
    "authorization": api_key,  # Lowercase, no 'Bearer' prefix
    "content-type": "application/json"  # Lowercase
}

# Add organization ID if needed
if organization_id:
    headers["managedorganizationid"] = organization_id
```

<<<<<<< HEAD
## Base URL

```python
base_url = "https://portalapi.g.threatlocker.com"
```

## Computer Data Endpoints

### 1. Get All Computers (Main Organization)

**Endpoint:** `POST /portalApi/Computer/ComputerGetByAllParameters`

**Purpose:** Retrieve all computers from the main organization with comprehensive details.

**Request:**
```python
url = f"{base_url}/portalApi/Computer/ComputerGetByAllParameters"

data = {
    "pageSize": 500,
    "pageNumber": 1,
    "searchText": "",
    "orderBy": "lastcheckin",
    "childOrganizations": False,
    "showLastCheckIn": True
=======
## Complete Field Reference

### Organization Fields

**Endpoint**: `POST /portalApi/Organization/OrganizationGetChildOrganizationsByParameters`

| Field Name | Type | Description | Example |
|------------|------|-------------|---------|
| `activeCount` | integer | Number of active computers | `0` |
| `billingJson` | string | Billing configuration JSON | `""` |
| `businessClassification` | integer | Business classification code | `0` |
| `businessClassificationName` | string | Business classification name | `""` |
| `computerCount` | integer | Total number of computers | `8` |
| `dateAdded` | string | When organization was added (ISO format) | `"2025-04-11T22:09:21Z"` |
| `displayName` | string | Organization display name | `"Averill & Reaney Attorneys at Law"` |
| `itarCompliant` | boolean | ITAR compliance status | `false` |
| `json` | string | Organization configuration JSON | `"{\"ApplicationControl\":2,...}"` |
| `lockdown` | integer | Lockdown status code | `8` |
| `name` | string | Organization name | `"Averill & Reaney Attorneys at Law"` |
| `organizationId` | string | Unique organization identifier | `"25702969-39c1-4eb6-bb40-2ae5485351f9"` |
| `products` | array | Array of product objects | See Products section below |

#### Organization Products Array

Each organization contains a `products` array with the following fields:

| Field Name | Type | Description |
|------------|------|-------------|
| `name` | string | Product name |
| `organizationId` | string | Organization ID |
| `productId` | string | Product identifier |
| `displayName` | string | Product display name |
| `isThreatLockerProtect` | boolean | ThreatLocker Protect status |
| `isThreatLockerUnified` | boolean | ThreatLocker Unified status |
| `productTrialId` | string | Trial identifier |
| `disablingProduct` | string | Disabling product reference |
| `isOverage` | boolean | Overage status |

### Computer Fields

**Endpoint**: `POST /portalApi/Computer/ComputerGetByAllParameters`

| Field Name | Type | Description | Example |
|------------|------|-------------|---------|
| `action` | string | Current action status | `"Secure"` |
| `application` | string | Application context | `""` |
| `appliesToType` | string | Applies to type | `""` |
| `computerGroupId` | string | Computer group identifier | `"a06736bb-b8d9-4aa0-807e-7b542612fb44"` |
| `computerId` | string | Unique computer identifier | `"c3fde5e9-b1af-4558-8408-16fff0345cf7"` |
| `computerName` | string | Computer name | `"RFG-DYP6X14 \| Tami Miller"` |
| `dateAdded` | string | When computer was added (ISO format) | `"2024-07-09T19:49:00Z"` |
| `denyCountOneDay` | integer | Deny count for 1 day | `4` |
| `denyCountSevenDays` | integer | Deny count for 7 days | `19` |
| `denyCountThreeDays` | integer | Deny count for 3 days | `8` |
| `driverStatusString` | string | Driver status | `"Active"` |
| `group` | string | Computer group name | `"Workstations"` |
| `hasAtLeastOneCheckin` | boolean | Has checked in at least once | `false` |
| `hasComputerPassword` | boolean | Has computer password set | `false` |
| `hasConfigManagerProduct` | boolean | Has Config Manager product | `true` |
| `hasInstalationAtLeastSevenDaysAgo` | boolean | Installation older than 7 days | `false` |
| `hasUnknownVersion` | boolean | Has unknown version | `false` |
| `hasZeroDeniesFourDays` | boolean | Zero denies in last 4 days | `false` |
| `hostname` | string | Computer hostname | `"RFG-DYP6X14"` |
| `installDate` | string | Installation date (ISO format) | `null` |
| `ipOperatingSystem` | string | IP operating system version | `"10.0.26100.5074"` |
| `isDeleted` | boolean | Is deleted | `false` |
| `isIRChild` | boolean | Is incident response child | `false` |
| `isInheritFromGroup` | boolean | Inherits from group | `true` |
| `isIsolated` | boolean | Is isolated | `false` |
| `isIsolationMode` | boolean | Is in isolation mode | `false` |
| `isLearningModeLongerThanFiveYears` | boolean | Learning mode longer than 5 years | `false` |
| `isLearningModeMoreThanSeven` | boolean | Learning mode more than 7 days | `false` |
| `isLearningMoreThanFourDays` | boolean | Learning more than 4 days | `false` |
| `isLockDownMode` | boolean | Is in lockdown mode | `false` |
| `isLockedOut` | boolean | Is locked out | `false` |
| `isNeededReview` | boolean | Needs review | `false` |
| `isOpsAlertsDisabled` | boolean | Operations alerts disabled | `false` |
| `isReadyToSecure` | boolean | Ready to secure | `false` |
| `isTamperProtectionDisabled` | boolean | Tamper protection disabled | `false` |
| `lastCheckin` | string | Last check-in time (ISO format) | `"2025-09-06T02:43:00Z"` |
| `lastCheckinIPAddress` | string | Last check-in IP address | `"174.137.4.56"` |
| `lastCheckinLocalIPAddresses` | array | Local IP addresses | `[]` |
| `licenseSetting` | string | License setting | `""` |
| `maintenanceEndDate` | string | Maintenance end date | `null` |
| `maintenanceTypeId` | integer | Maintenance type ID | `0` |
| `maintenenceBannerIds` | array | Maintenance banner IDs | `[]` |
| `manualCount` | integer | Manual count | `0` |
| `mode` | string | Security mode | `"Secure"` |
| `name` | string | Computer name | `"RFG-DYP6X14"` |
| `newThreatLockerVersion` | string | New ThreatLocker version | `"10.5.2"` |
| `operatingSystem` | string | Operating system | `"Windows 11 Business "` |
| `organization` | string | Organization name | `"Rigby Financial Group"` |
| `organizationId` | string | Organization identifier | `"ac8fa06c-4431-4c44-9c53-1a0b44e8dd75"` |
| `osType` | integer | Operating system type | `1` |
| `parentId` | string | Parent identifier | `""` |
| `progressBarLearning` | integer | Learning progress bar | `0` |
| `restartComputerNeeded` | boolean | Computer restart needed | `false` |
| `serviceVersion` | string | Service version | `"10.3.4.3791"` |
| `shouldRestart` | boolean | Should restart | `false` |
| `startDateTime` | string | Start date time | `"2025-09-06T02:43:01Z"` |
| `targetThreatLockerVersion` | string | Target ThreatLocker version | `"10.5.2"` |
| `threatLockerVersion` | string | Current ThreatLocker version | `"10.3.4.3791/10.3.0.907AMD64"` |
| `threatLockerVersionId` | string | ThreatLocker version ID | `null` |
| `totalRows` | integer | Total rows count | `377` |
| `uploadBaseFile` | boolean | Upload base file | `false` |
| `username` | string | Username | `"AZUREAD\\TAMIMILLER"` |
| `versionMajor` | integer | Major version number | `10` |
| `versionMinor` | integer | Minor version number | `3` |
| `status` | string | Computer status | `"Active"` |
| `id` | string | Computer ID (alternative to computerId) | `"c3fde5e9-b1af-4558-8408-16fff0345cf7"` |

## API Endpoints

### 1. Get Organizations

**Endpoint**: `POST /portalApi/Organization/OrganizationGetChildOrganizationsByParameters`

**Request**:
```python
url = f"{base_url}/portalApi/Organization/OrganizationGetChildOrganizationsByParameters"

data = {
    "pageSize": 25,
    "pageNumber": 1,
    "includeProductBundles": False
>>>>>>> 7aa16e4 (Add comprehensive ThreatLocker API field documentation - Complete field reference with 78 unique fields from live API analysis, including organization and computer field details, usage examples, and best practices)
}

response = requests.post(url, headers=headers, json=data, timeout=30)
```

### 4. Get Computer for Edit (Update Preparation)

**Endpoint**: `GET /portalapi/Computer/ComputerGetForEditById`

**Purpose**: Retrieve complete computer data structure required for updates.

**Request**:
```python
url = f"{base_url}/portalapi/Computer/ComputerGetForEditById"

# Headers with organization ID (CRITICAL for cross-org updates)
headers_with_org = headers.copy()
if organization_id:
    headers_with_org["managedorganizationid"] = organization_id

# Query parameters
params = {
    "computerId": computer_id  # CRITICAL: Use "computerId", not "id"
}

response = requests.get(url, headers=headers_with_org, params=params, timeout=30)
```

**Response**: Complete computer data structure with all fields required for updates.

### 5. Update Computer Name

**Endpoint**: `PATCH /portalapi/Computer/ComputerUpdateForEdit`

**Purpose**: Update computer name and other computer properties.

**CRITICAL REQUIREMENTS**:
- Must first call `ComputerGetForEditById` to get complete data structure
- Use "name" field (NOT "computerName") in update payload
- Include ALL fields from the GET response in the PATCH payload
- Set `managedorganizationid` header for organization context

**Request**:
```python
# Step 1: Get current computer data (REQUIRED)
get_url = f"{base_url}/portalapi/Computer/ComputerGetForEditById"
get_headers = headers.copy()
if organization_id:
    get_headers["managedorganizationid"] = organization_id

get_params = {"computerId": computer_id}
get_response = requests.get(get_url, headers=get_headers, params=get_params, timeout=30)
current_data = get_response.json()

# Step 2: Create update payload with complete data structure
update_data = current_data.copy()
update_data["name"] = new_name  # CRITICAL: Use "name", not "computerName"

# Step 3: Send update request
update_url = f"{base_url}/portalapi/Computer/ComputerUpdateForEdit"
update_headers = headers.copy()
if organization_id:
    update_headers["managedorganizationid"] = organization_id

response = requests.patch(update_url, headers=update_headers, json=update_data, timeout=30)
```

**Response**: Success/error status with updated computer information.

**Special Character Support**:
- ✅ Double quotes: `"TK"` - Fully supported
- ✅ Pipe symbols: `|` - Fully supported  
- ✅ Long names: 200+ characters - Fully supported
- ✅ Special characters: `-`, `'`, `"` - All supported

**Error Handling**:
- **417 Invalid Computer Name**: Name format validation failed
- **404 Not Found**: Computer ID doesn't exist
- **403 Forbidden**: Insufficient permissions or wrong organization

<<<<<<< HEAD
**Response Fields Available:**
```json
{
  "computerName": "DESKTOP-ABC123",
  "hostname": "DESKTOP-ABC123",
  "group": "Default Group",
  "operatingSystem": "Windows 10 Pro",
  "mode": "Learning",
  "lastCheckin": "2025-09-01T02:15:57.435815Z",
  "denyCountOneDay": 5,
  "denyCountThreeDays": 23,
  "denyCountSevenDays": 89,
  "organizationId": "dd850352-ee85-436b-8e41-818bdb52712c",
  "computerId": "12345678-1234-1234-1234-123456789012",
  "ipAddress": "192.168.1.100",
  "macAddress": "00:11:22:33:44:55",
  "username": "DOMAIN\\username",
  "isOnline": true,
  "isLockedOut": false,
  "isIsolated": false,
  "hasUnknownVersion": false,
  "targetThreatLockerVersion": "10.3.4",
  "isDeleted": false
}
```

### 2. Get Computers by Specific Organization

**Endpoint:** `POST /portalApi/Computer/ComputerGetByAllParameters`

**Purpose:** Retrieve computers for a specific organization by setting the organization ID in headers.

**Request:**
```python
# Set organization ID in headers
=======
**Response**: Array of organization objects with all fields listed above.

### 2. Get Computers (Single Organization)

**Endpoint**: `POST /portalApi/Computer/ComputerGetByAllParameters`

**Request**:
```python
url = f"{base_url}/portalApi/Computer/ComputerGetByAllParameters"

# Headers with organization ID
>>>>>>> 7aa16e4 (Add comprehensive ThreatLocker API field documentation - Complete field reference with 78 unique fields from live API analysis, including organization and computer field details, usage examples, and best practices)
headers_with_org = headers.copy()
headers_with_org["managedorganizationid"] = organization_id

data = {
    "pageSize": 500,
    "pageNumber": 1,
    "searchText": "",
    "orderBy": "lastcheckin",
    "childOrganizations": False,
    "showLastCheckIn": True
}

response = requests.post(url, headers=headers_with_org, json=data, timeout=30)
```

<<<<<<< HEAD
### 3. Get All Computers from All Child Organizations

**Endpoint:** `POST /portalApi/Computer/ComputerGetByAllParameters`

**Purpose:** Retrieve computers from all child organizations in a single call.

**Request:**
```python
=======
**Response**: Array of computer objects with all fields listed above.

### 3. Get All Computers (All Organizations)

**Endpoint**: `POST /portalApi/Computer/ComputerGetByAllParameters`

**Request**:
```python
url = f"{base_url}/portalApi/Computer/ComputerGetByAllParameters"

>>>>>>> 7aa16e4 (Add comprehensive ThreatLocker API field documentation - Complete field reference with 78 unique fields from live API analysis, including organization and computer field details, usage examples, and best practices)
data = {
    "pageSize": 500,
    "pageNumber": 1,
    "searchText": "",
    "orderBy": "lastcheckin",
    "childOrganizations": True,  # Key difference
    "showLastCheckIn": True
}

response = requests.post(url, headers=headers, json=data, timeout=30)
```

<<<<<<< HEAD
## Computer Analytics Data

### Computer Analytics Endpoint

**Endpoint:** `/api/computer-analytics/{organization_id}`

**Purpose:** Get aggregated analytics for computers in a specific organization.

**Response:**
```json
{
  "status": "success",
  "data": {
    "total_computers": 43,
    "computer_groups": {
      "Default Group": 35,
      "Servers": 8
    },
    "operating_systems": {
      "Windows 10 Pro": 25,
      "Windows 11 Pro": 12,
      "Windows Server 2019": 6
    },
    "security_status": {
      "Learning": 30,
      "Enforcement": 13
    },
    "recent_activity": 28,
    "deny_counts": {
      "one_day": 156,
      "three_days": 892,
      "seven_days": 2341
    }
  }
}
```

## Organization Data

### Get Organizations with Computer Counts

**Endpoint:** `POST /portalApi/Organization/OrganizationGetChildOrganizationsByParameters`

**Purpose:** Retrieve all organizations with their computer counts and deny statistics.

**Request:**
```python
url = f"{base_url}/portalApi/Organization/OrganizationGetChildOrganizationsByParameters"

data = {
    "pageSize": 25,
    "pageNumber": 1,
    "includeProductBundles": False
}

response = requests.post(url, headers=headers, json=data, timeout=30)
```

**Response Fields:**
```json
{
  "organizationId": "dd850352-ee85-436b-8e41-818bdb52712c",
  "displayName": "Ener Systems",
  "name": "ener-systems",
  "computerCount": 43,
  "activeCount": 0,
  "dateAdded": "2021-01-01T00:00:00Z",
  "computerDenyCountDtos": [
    {
      "oneDay": 156,
      "threeDays": 892,
      "sevenDays": 2341,
      "organizationId": "dd850352-ee85-436b-8e41-818bdb52712c"
    }
  ],
  "products": [
    {
      "name": "defaultdeny",
      "displayName": "Allowlisting",
      "isThreatLockerProtect": true
    },
    {
      "name": "ringfencing",
      "displayName": "Ringfencing",
      "isThreatLockerProtect": true
    }
  ]
}
```

## Computer Name Update Implementation

### Complete Working Example

```python
#!/usr/bin/env python3
"""
ThreatLocker Computer Name Update - Complete Working Implementation
"""

import requests
import json
from datetime import datetime
from typing import Dict, Any, Optional
import os

class ThreatLockerUpdateClient:
    """ThreatLocker API client for computer name updates"""
    
    def __init__(self):
        # Load environment variables
        from dotenv import load_dotenv
        load_dotenv()
        
        self.base_url = "https://portalapi.g.threatlocker.com"
        self.api_key = os.getenv("THREATLOCKER_API_KEY", "")
        self.organization_id = os.getenv("THREATLOCKER_ORGANIZATION_ID", "")
        
        # Headers for API requests
        self.headers = {
            "authorization": self.api_key,
            "content-type": "application/json"
        }
        
        if self.organization_id:
            self.headers["managedorganizationid"] = self.organization_id
    
    def get_computer_for_edit(self, computer_id: str, organization_id: Optional[str] = None) -> Dict[str, Any]:
        """Get complete computer data structure for updates"""
        try:
            url = f"{self.base_url}/portalapi/Computer/ComputerGetForEditById"
            
            # Headers with organization ID
            headers = self.headers.copy()
            if organization_id:
                headers["managedorganizationid"] = organization_id
            
            # Query parameters
            params = {
                "computerId": computer_id  # CRITICAL: Use "computerId", not "id"
            }
            
            response = requests.get(url, headers=headers, params=params, timeout=30)
            
            if response.status_code == 200:
                return {
                    "status": "success",
                    "data": response.json(),
                    "timestamp": datetime.utcnow().isoformat()
                }
            else:
                return {
                    "status": "error",
                    "message": f"Failed to get computer data: {response.status_code}",
                    "status_code": response.status_code,
                    "error": response.text,
                    "timestamp": datetime.utcnow().isoformat()
                }
                
        except Exception as e:
            return {
                "status": "error",
                "message": f"Error getting computer data: {str(e)}",
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }
    
    def update_computer_name(self, computer_id: str, new_name: str, 
                           organization_id: Optional[str] = None) -> Dict[str, Any]:
        """Update computer name with complete data structure"""
        try:
            # Step 1: Get current computer data (REQUIRED)
            get_result = self.get_computer_for_edit(computer_id, organization_id)
            if get_result["status"] != "success":
                return get_result
            
            current_data = get_result["data"]
            
            # Step 2: Create update payload with complete data structure
            update_data = current_data.copy()
            update_data["name"] = new_name  # CRITICAL: Use "name", not "computerName"
            
            # Step 3: Send update request
            url = f"{self.base_url}/portalapi/Computer/ComputerUpdateForEdit"
            headers = self.headers.copy()
            if organization_id:
                headers["managedorganizationid"] = organization_id
            
            response = requests.patch(url, headers=headers, json=update_data, timeout=30)
            
            if response.status_code == 200:
                return {
                    "status": "success",
                    "message": f"Computer name updated successfully to: {new_name}",
                    "computer_id": computer_id,
                    "old_name": current_data.get("name", "Unknown"),
                    "new_name": new_name,
                    "response": response.json() if response.content else None,
                    "timestamp": datetime.utcnow().isoformat()
                }
            else:
                return {
                    "status": "error",
                    "message": f"Failed to update computer name: {response.status_code}",
                    "computer_id": computer_id,
                    "new_name": new_name,
                    "status_code": response.status_code,
                    "error": response.text,
                    "timestamp": datetime.utcnow().isoformat()
                }
                
        except Exception as e:
            return {
                "status": "error",
                "message": f"Error updating computer name: {str(e)}",
                "computer_id": computer_id,
                "new_name": new_name,
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }
    
    def find_computer_by_hostname(self, hostname: str, organization_id: Optional[str] = None) -> Dict[str, Any]:
        """Find computer by hostname to get computer_id"""
        try:
            url = f"{self.base_url}/portalApi/Computer/ComputerGetByAllParameters"
            
            headers = self.headers.copy()
            if organization_id:
                headers["managedorganizationid"] = organization_id
            
            data = {
                "pageSize": 500,
                "pageNumber": 1,
                "searchText": hostname,  # Search by hostname
                "orderBy": "lastcheckin",
                "childOrganizations": True,
                "showLastCheckIn": True
            }
            
            response = requests.post(url, headers=headers, json=data, timeout=30)
            
            if response.status_code == 200:
                computers = response.json()
                
                # Find exact hostname match
                for computer in computers:
                    if computer.get("hostname", "").lower() == hostname.lower():
                        return {
                            "status": "success",
                            "computer_id": computer.get("computerId"),
                            "computer_name": computer.get("computerName"),
                            "hostname": computer.get("hostname"),
                            "organization_id": computer.get("organizationId"),
                            "timestamp": datetime.utcnow().isoformat()
                        }
                
                return {
                    "status": "error",
                    "message": f"Computer with hostname '{hostname}' not found",
                    "hostname": hostname,
                    "timestamp": datetime.utcnow().isoformat()
                }
            else:
                return {
                    "status": "error",
                    "message": f"Failed to search computers: {response.status_code}",
                    "status_code": response.status_code,
                    "error": response.text,
                    "timestamp": datetime.utcnow().isoformat()
                }
                
        except Exception as e:
            return {
                "status": "error",
                "message": f"Error searching computers: {str(e)}",
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }

# Example Usage
def main():
    """Example usage of the ThreatLocker update client"""
    client = ThreatLockerUpdateClient()
    
    # Example: Update computer name with double quotes
    hostname = "CHI-6RPN4C4"
    new_name = 'CHI-6RPN4C4 | Truman "TK" Bates'
    
    print(f"Searching for computer: {hostname}")
    search_result = client.find_computer_by_hostname(hostname)
    
    if search_result["status"] == "success":
        computer_id = search_result["computer_id"]
        organization_id = search_result["organization_id"]
        
        print(f"Found computer: {computer_id}")
        print(f"Current name: {search_result['computer_name']}")
        print(f"Updating to: {new_name}")
        
        update_result = client.update_computer_name(computer_id, new_name, organization_id)
        
        if update_result["status"] == "success":
            print("✅ Update successful!")
            print(f"Old name: {update_result['old_name']}")
            print(f"New name: {update_result['new_name']}")
        else:
            print("❌ Update failed!")
            print(f"Error: {update_result['message']}")
    else:
        print("❌ Computer not found!")
        print(f"Error: {search_result['message']}")

if __name__ == "__main__":
    main()
```

## Complete Python Implementation

### ThreatLocker API Client Class

```python
#!/usr/bin/env python3
"""
ThreatLocker API Client for Computer Details
"""

import requests
import json
from datetime import datetime
from typing import Dict, Any, Optional
import os

class ThreatLockerAPIClient:
    """ThreatLocker API client for computer data retrieval"""
    
    def __init__(self):
        # Load environment variables
        from dotenv import load_dotenv
        load_dotenv()
        
        self.base_url = "https://portalapi.g.threatlocker.com"
        self.api_key = os.getenv("THREATLOCKER_API_KEY", "")
        self.organization_id = os.getenv("THREATLOCKER_ORGANIZATION_ID", "")
        
        # Headers for API requests
        self.headers = {
            "authorization": self.api_key,
            "content-type": "application/json"
        }
        
        if self.organization_id:
            self.headers["managedorganizationid"] = self.organization_id
    
    def get_computers(self, organization_id: Optional[str] = None) -> Dict[str, Any]:
        """Get list of computers with full details"""
        try:
            url = f"{self.base_url}/portalApi/Computer/ComputerGetByAllParameters"
            
            # Headers with optional organization ID override
            headers = self.headers.copy()
            if organization_id:
                headers["managedorganizationid"] = organization_id
            
            data = {
                "pageSize": 500,
                "pageNumber": 1,
                "searchText": "",
                "orderBy": "lastcheckin",
                "childOrganizations": False,
                "showLastCheckIn": True
            }
            
            response = requests.post(url, headers=headers, json=data, timeout=30)
            
            if response.status_code == 200:
                computers = response.json()
                return {
                    "status": "success",
                    "data": computers,
                    "count": len(computers),
                    "organization_id": organization_id or self.organization_id,
                    "timestamp": datetime.utcnow().isoformat()
                }
            else:
                return {
                    "status": "error",
                    "message": f"Failed to get computers: {response.status_code}",
                    "status_code": response.status_code,
                    "error": response.text,
                    "timestamp": datetime.utcnow().isoformat()
                }
                
        except Exception as e:
            return {
                "status": "error",
                "message": f"Error getting computers: {str(e)}",
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }
    
    def get_all_computers_with_child_organizations(self) -> Dict[str, Any]:
        """Get all computers from all child organizations"""
        try:
            url = f"{self.base_url}/portalApi/Computer/ComputerGetByAllParameters"
            
            data = {
                "pageSize": 500,
                "pageNumber": 1,
                "searchText": "",
                "orderBy": "lastcheckin",
                "childOrganizations": True,  # Get all child org computers
                "showLastCheckIn": True
            }
            
            response = requests.post(url, headers=self.headers, json=data, timeout=30)
            
            if response.status_code == 200:
                computers = response.json()
                return {
                    "status": "success",
                    "data": computers,
                    "count": len(computers),
                    "message": "All computers from all child organizations retrieved",
                    "timestamp": datetime.utcnow().isoformat()
                }
            else:
                return {
                    "status": "error",
                    "message": f"Failed to get all computers: {response.status_code}",
                    "status_code": response.status_code,
                    "error": response.text,
                    "timestamp": datetime.utcnow().isoformat()
                }
                
        except Exception as e:
            return {
                "status": "error",
                "message": f"Error getting all computers: {str(e)}",
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }
    
    def get_organizations(self) -> Dict[str, Any]:
        """Get list of organizations with computer counts"""
        try:
            url = f"{self.base_url}/portalApi/Organization/OrganizationGetChildOrganizationsByParameters"
            
            all_organizations = []
            page_number = 1
            page_size = 25
            
            while True:
                data = {
                    "pageSize": page_size,
                    "pageNumber": page_number,
                    "includeProductBundles": False
                }
                
                response = requests.post(url, headers=self.headers, json=data, timeout=30)
                
                if response.status_code == 200:
                    response_data = response.json()
                    
                    if isinstance(response_data, list):
                        organizations = response_data
                    elif isinstance(response_data, dict) and 'data' in response_data:
                        organizations = response_data['data']
                    else:
                        organizations = []
                    
                    if not organizations:
                        break
                    
                    all_organizations.extend(organizations)
                    
                    if len(organizations) < page_size:
                        break
                    
                    page_number += 1
                else:
                    return {
                        "status": "error",
                        "message": f"Failed to get organizations - Status {response.status_code}",
                        "status_code": response.status_code,
                        "error": response.text,
                        "timestamp": datetime.utcnow().isoformat()
                    }
            
            return {
                "status": "success",
                "message": f"Organizations retrieved successfully (Total: {len(all_organizations)})",
                "status_code": 200,
                "data": all_organizations,
                "timestamp": datetime.utcnow().isoformat()
            }
                
        except Exception as e:
            return {
                "status": "error",
                "message": f"Error getting organizations: {str(e)}",
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }
    
    def test_authentication(self) -> Dict[str, Any]:
        """Test API authentication and connectivity"""
        try:
            url = f"{self.base_url}/portalApi/Organization/OrganizationGetChildOrganizationsByParameters"
            
            data = {
                "pageSize": 25,
                "pageNumber": 1,
                "includeProductBundles": False
            }
            
            response = requests.post(url, headers=self.headers, json=data, timeout=30)
            
            if response.status_code == 200:
                return {
                    "status": "success",
                    "message": "Authentication successful",
                    "status_code": response.status_code,
                    "data": response.json() if response.content else None,
                    "timestamp": datetime.utcnow().isoformat()
                }
            elif response.status_code == 401:
                return {
                    "status": "error",
                    "message": "Authentication failed - Invalid API key",
                    "status_code": response.status_code,
                    "error": "Unauthorized",
                    "timestamp": datetime.utcnow().isoformat()
                }
            else:
                return {
                    "status": "error",
                    "message": f"API request failed with status {response.status_code}",
                    "status_code": response.status_code,
                    "error": response.text,
                    "timestamp": datetime.utcnow().isoformat()
                }
                
        except Exception as e:
            return {
                "status": "error",
                "message": f"Unexpected error: {str(e)}",
                "error": str(e),
                "timestamp": datetime.utcnow().isoformat()
            }

# Example Usage
def main():
    """Example usage of the ThreatLocker API client"""
    client = ThreatLockerAPIClient()
    
    # Test authentication
    print("Testing authentication...")
    auth_result = client.test_authentication()
    print(f"Auth status: {auth_result['status']}")
    
    if auth_result['status'] == 'success':
        # Get organizations
        print("\nGetting organizations...")
        orgs_result = client.get_organizations()
        if orgs_result['status'] == 'success':
            print(f"Found {len(orgs_result['data'])} organizations")
            
            # Get computers for first organization
            if orgs_result['data']:
                first_org = orgs_result['data'][0]
                org_id = first_org['organizationId']
                org_name = first_org['displayName']
                
                print(f"\nGetting computers for {org_name}...")
                computers_result = client.get_computers(org_id)
                if computers_result['status'] == 'success':
                    print(f"Found {computers_result['count']} computers")
                    
                    # Show first computer details
                    if computers_result['data']:
                        first_computer = computers_result['data'][0]
                        print(f"\nFirst computer details:")
                        print(f"  Name: {first_computer.get('computerName', 'Unknown')}")
                        print(f"  OS: {first_computer.get('operatingSystem', 'Unknown')}")
                        print(f"  Mode: {first_computer.get('mode', 'Unknown')}")
                        print(f"  Last Checkin: {first_computer.get('lastCheckin', 'Never')}")
                        print(f"  Deny Count (1 day): {first_computer.get('denyCountOneDay', 0)}")
                        print(f"  Deny Count (3 days): {first_computer.get('denyCountThreeDays', 0)}")
                        print(f"  Deny Count (7 days): {first_computer.get('denyCountSevenDays', 0)}")

if __name__ == "__main__":
    main()
```

## Dashboard Modal Data Structure

### Computer Details Displayed in Modals

The dashboard modals display the following computer information:

1. **Basic Information:**
   - Computer Name
   - Hostname
   - Group
   - Operating System
   - Security Mode (Learning/Enforcement)

2. **Activity Information:**
   - Last Check-in Time
   - Online Status
   - Lockout Status
   - Isolation Status

3. **Security Metrics:**
   - Deny Count (1 day)
   - Deny Count (3 days)
   - Deny Count (7 days)
   - ThreatLocker Version

4. **Network Information:**
   - IP Address
   - MAC Address
   - Username

5. **Analytics Aggregated by:**
   - Operating Systems
   - Security Status
   - Computer Groups
   - Deny Counts (totaled)

## Error Handling

### Common Error Responses

1. **401 Unauthorized:**
   - Invalid API key
   - Check `THREATLOCKER_API_KEY` environment variable

2. **403 Forbidden:**
   - Invalid organization ID
   - Insufficient permissions
   - Check `THREATLOCKER_ORGANIZATION_ID` environment variable

3. **404 Not Found:**
   - Endpoint not found
   - Organization doesn't exist

4. **500 Internal Server Error:**
   - Server-side issue
   - Try again later

### Best Practices

1. **Always test authentication first** before making other API calls
2. **Use pagination** for large datasets (default page size is 500)
3. **Handle timeouts** (recommended 30 seconds)
4. **Cache organization data** to avoid repeated calls
5. **Use childOrganizations=True** to get all computers across all organizations
6. **Format dates properly** for display (lastCheckin is in ISO format)

## Testing the API

### Quick Test Script

```python
# Quick test to verify API access
import os
from dotenv import load_dotenv
import requests

load_dotenv()

api_key = os.getenv("THREATLOCKER_API_KEY")
org_id = os.getenv("THREATLOCKER_ORGANIZATION_ID")

headers = {
    "authorization": api_key,
    "content-type": "application/json"
}

if org_id:
    headers["managedorganizationid"] = org_id

# Test authentication
url = "https://portalapi.g.threatlocker.com/portalApi/Organization/OrganizationGetChildOrganizationsByParameters"
data = {"pageSize": 1, "pageNumber": 1, "includeProductBundles": False}

response = requests.post(url, headers=headers, json=data, timeout=30)
print(f"Status: {response.status_code}")
print(f"Response: {response.json() if response.status_code == 200 else response.text}")
```

This guide provides everything needed to access the ThreatLocker API and retrieve the computer details that are displayed in the dashboard modals.
=======
**Response**: Array of computer objects from all organizations.

## Dashboard Implementation Fields

### Fields Used in ThreatLocker Dashboard

The ThreatLocker Dashboard uses the following fields from the API responses:

#### Main Dashboard (Organizations Table)
| Field | Source | Usage | Example |
|-------|--------|-------|---------|
| `id` | `organizationId` | Organization identifier for API calls | `"ac8fa06c-4431-4c44-9c53-1a0b44e8dd75"` |
| `name` | `displayName` | Organization display name | `"Ener Systems"` |
| `computer_count` | Calculated | Total computers in organization | `43` |
| `dateAdded` | `dateAdded` | When organization was added | `"2021-01-01T00:00:00Z"` |

#### Modal (Computers Table)
| Field | Source | Usage | Example |
|-------|--------|-------|---------|
| `organization` | `organization` | Organization name | `"Ener Systems"` |
| `hostname` | `hostname` | Computer hostname | `"DESKTOP-ABC123"` |
| `computerName` | `computerName` | Full computer name | `"DESKTOP-ABC123 \| John Doe"` |
| `dateAdded` | `dateAdded` | Installation date | `"2024-07-09T19:49:00Z"` |
| `operatingSystem` | `operatingSystem` | OS version | `"Windows 11 Business"` |
| `lastCheckin` | `lastCheckin` | Last check-in time | `"2025-09-06T02:43:00Z"` |
| `group` | `group` | Computer group | `"Workstations"` |
| `mode` | `mode` | Security mode | `"Learning"` or `"Secure"` |

#### Analytics Calculations
| Field | Usage | Example |
|-------|-------|---------|
| `denyCountOneDay` | 1-day deny count | `4` |
| `denyCountThreeDays` | 3-day deny count | `8` |
| `denyCountSevenDays` | 7-day deny count | `19` |

#### CSV Export Fields
| Field | Source | Usage |
|-------|--------|-------|
| `organization` | `organization` | Organization name |
| `hostname` | `hostname` | Computer hostname |
| `computerName` | `computerName` | Full computer name |
| `dateAdded` | `dateAdded` | Installation date |
| `operatingSystem` | `operatingSystem` | OS version |
| `lastCheckin` | `lastCheckin` | Last check-in time |
| `group` | `group` | Computer group |
| `securityMode` | `mode` | Security mode |
| `organizationId` | `organizationId` | Organization ID |
| `id` | `computerId` or `id` | Computer ID |
| `status` | `status` | Computer status |

## Field Usage Examples

### Common Computer Fields for Dashboard Display

```python
# Basic computer information
computer_name = computer.get('computerName', 'Unknown')
hostname = computer.get('hostname', 'Unknown')
organization = computer.get('organization', 'Unknown')
group = computer.get('group', 'Unknown')
operating_system = computer.get('operatingSystem', 'Unknown')
mode = computer.get('mode', 'Unknown')

# Date fields (ISO format)
date_added = computer.get('dateAdded')  # Organization addition date
install_date = computer.get('installDate')  # Computer installation date
last_checkin = computer.get('lastCheckin')  # Last check-in time

# Deny counts
deny_1_day = computer.get('denyCountOneDay', 0)
deny_3_days = computer.get('denyCountThreeDays', 0)
deny_7_days = computer.get('denyCountSevenDays', 0)

# Status flags
is_online = computer.get('hasAtLeastOneCheckin', False)
is_locked_out = computer.get('isLockedOut', False)
is_isolated = computer.get('isIsolated', False)
is_learning = computer.get('mode') == 'Learning'

# Version information
current_version = computer.get('threatLockerVersion', 'Unknown')
target_version = computer.get('targetThreatLockerVersion', 'Unknown')
needs_restart = computer.get('restartComputerNeeded', False)
```

### Organization Field Usage

```python
# Organization information
org_name = org.get('displayName', 'Unknown')
org_id = org.get('organizationId', '')
computer_count = org.get('computerCount', 0)
active_count = org.get('activeCount', 0)
date_added = org.get('dateAdded')  # When org was added to ThreatLocker

# Products
products = org.get('products', [])
for product in products:
    product_name = product.get('name', '')
    is_protect = product.get('isThreatLockerProtect', False)
    is_unified = product.get('isThreatLockerUnified', False)
```

### Dashboard-Specific Field Usage

```python
# Dashboard organization data structure
dashboard_org = {
    "id": org.get('organizationId'),
    "name": org.get('displayName', org.get('name', 'Unknown')),
    "computer_count": len(computers),  # Calculated from computers API
    "status": "active" if len(computers) > 0 else "inactive",
    "dateAdded": org.get('dateAdded')
}

# Dashboard computer data structure
dashboard_computer = {
    "organization": computer.get('organization', 'Unknown'),
    "hostname": computer.get('hostname', 'Unknown'),
    "computerName": computer.get('computerName', computer.get('hostname', 'Unknown')),
    "dateAdded": computer.get('dateAdded'),
    "operatingSystem": computer.get('operatingSystem', 'Unknown'),
    "lastCheckin": computer.get('lastCheckin'),
    "group": computer.get('group', 'Unknown'),
    "mode": computer.get('mode', 'Unknown'),
    "organizationId": computer.get('organizationId'),
    "id": computer.get('computerId', computer.get('id')),
    "status": computer.get('status', 'Unknown')
}

# CSV export field mapping
csv_fields = [
    'organization', 'hostname', 'computerName', 'dateAdded',
    'operatingSystem', 'lastCheckin', 'group', 'securityMode',
    'organizationId', 'id', 'status'
]
```

## Data Types and Formatting

### Date Fields
- **Format**: ISO 8601 UTC format (`"2025-09-06T02:43:00Z"`)
- **Common Fields**: `dateAdded`, `lastCheckin`, `installDate`, `startDateTime`
- **Usage**: Convert to local timezone for display

### Boolean Fields
- **Format**: `true`/`false`
- **Common Fields**: `isLockedOut`, `isIsolated`, `hasAtLeastOneCheckin`, `restartComputerNeeded`

### Integer Fields
- **Format**: Numeric values
- **Common Fields**: `computerCount`, `denyCountOneDay`, `denyCountThreeDays`, `denyCountSevenDays`

### String Fields
- **Format**: Text values
- **Common Fields**: `computerName`, `hostname`, `organization`, `operatingSystem`, `mode`

## Error Handling

### Common HTTP Status Codes
- **200**: Success
- **401**: Unauthorized (invalid API key)
- **403**: Forbidden (invalid organization ID)
- **404**: Not Found (endpoint or resource not found)
- **500**: Internal Server Error

### Response Structure
```python
# Success response
{
    "status": "success",
    "data": [...],  # Array of objects
    "timestamp": "2025-09-06T02:43:00Z"
}

# Error response
{
    "status": "error",
    "message": "Error description",
    "timestamp": "2025-09-06T02:43:00Z"
}
```

## Best Practices

1. **Always check field existence** before accessing values
2. **Use default values** for optional fields
3. **Handle null values** appropriately
4. **Format dates** according to user timezone
5. **Cache organization data** to avoid repeated API calls
6. **Use pagination** for large datasets
7. **Implement retry logic** for failed requests
8. **Monitor API rate limits**

## Field Analysis Summary

**Total Fields Analyzed**: 78 unique fields  
**Organization Fields**: 13 fields  
**Computer Fields**: 65 fields  
**Analysis Date**: September 6, 2025  
**Last Updated**: October 8, 2025  
**API Version**: ThreatLocker Portal API v1

## Update Functionality Summary

**Computer Name Updates**: ✅ **FULLY SUPPORTED**
- **Endpoints**: `GET /portalapi/Computer/ComputerGetForEditById`, `PATCH /portalapi/Computer/ComputerUpdateForEdit`
- **Special Characters**: Double quotes, pipe symbols, long names (200+ chars) - All supported
- **Cross-Organization**: Supported with proper `managedorganizationid` header
- **Critical Requirements**: Must use complete data structure from GET response in PATCH payload
- **Field Usage**: Use "name" field (NOT "computerName") in update payload

**Key Implementation Notes**:
1. **Two-Step Process**: Always GET current data first, then PATCH with complete structure
2. **Organization Context**: Set `managedorganizationid` header for cross-org updates
3. **Parameter Names**: Use "computerId" (not "id") in GET requests
4. **Error Handling**: 417 = Invalid Computer Name, 404 = Not Found, 403 = Forbidden

This comprehensive field reference provides all the information needed to work with ThreatLocker API data in dashboard applications and other integrations, including full computer name update functionality.
>>>>>>> 7aa16e4 (Add comprehensive ThreatLocker API field documentation - Complete field reference with 78 unique fields from live API analysis, including organization and computer field details, usage examples, and best practices)
